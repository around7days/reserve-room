# -------------------------------------
# CentOS環境セットアップ（rootユーザで実行）
# -------------------------------------
# ユーザ生成
useradd rs01
passwd rs01

# 配備先フォルダ生成
mkdir -p /opt/rs01/reserve-room
chown -R rs01:rs01 /opt/rs01

# nodejs, npmのインストール
yum install https://rpm.nodesource.com/pub_14.x/el/7/x86_64/nodesource-release-el7-1.noarch.rpm
yum install nodejs npm

# sqliteのインストール（入ってなければ）
yum install sqlite

# C++コンパイラのインストール（入ってなければ）
#yum install -y centos-release-scl 要らないかも・・・
yum install gcc-c++

# -------------------------------------
# アプリセットアップ（rs01ユーザで実行）
# -------------------------------------
# アプリ配備
/opt/rs01/reserve-room にアプリを配備
　※data,logs,node_modules フォルダは配備不要

# DBセットアップ
mkdir /opt/rs01/reserve-room/data
sqlite3 /opt/rs01/reserve-room/data/sqlite.db < /opt/rs01/reserve-room/documents/setup/schema.sql
sqlite3 /opt/rs01/reserve-room/data/sqlite.db < /opt/rs01/reserve-room/documents/setup/data.sql

# 外部モジュール最新化
cd /opt/rs01/reserve-room/
npm update

# アプリ起動
cd /opt/rs01/reserve-room/
node app/app.js
